"use strict";(self.webpackChunkchat_ui=self.webpackChunkchat_ui||[]).push([[85],{9085:(Ut,z,a)=>{a.r(z),a.d(z,{ChatViewComponent:()=>Pe});var U={};a.r(U),a.d(U,{Decoder:()=>dt,Encoder:()=>pe,PacketType:()=>l,protocol:()=>Nt});var y={};a.r(y),a.d(y,{Manager:()=>st,Socket:()=>gt,connect:()=>R,default:()=>R,io:()=>R,protocol:()=>Nt});var L=a(1135),rt=a(8505),o=a(4650),$=a(9751),ot=a(3099);const w=Object.create(null);w.open="0",w.close="1",w.ping="2",w.pong="3",w.message="4",w.upgrade="5",w.noop="6";const P=Object.create(null);Object.keys(w).forEach(n=>{P[w[n]]=n});const ct={type:"error",data:"parser error"},at="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),H="function"==typeof ArrayBuffer,Z=(n,t)=>{const e=new FileReader;return e.onload=function(){const s=e.result.split(",")[1];t("b"+s)},e.readAsDataURL(n)},J=({type:n,data:t},e,s)=>at&&t instanceof Blob?e?s(t):Z(t,s):H&&(t instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer)(t))?e?s(t):Z(new Blob([t]),s):s(w[n]+(t||"")),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",k=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<m.length;n++)k[m.charCodeAt(n)]=n;const d="function"==typeof ArrayBuffer,v=(n,t)=>{if(d){const e=(n=>{let s,r,c,f,g,t=.75*n.length,e=n.length,i=0;"="===n[n.length-1]&&(t--,"="===n[n.length-2]&&t--);const O=new ArrayBuffer(t),N=new Uint8Array(O);for(s=0;s<e;s+=4)r=k[n.charCodeAt(s)],c=k[n.charCodeAt(s+1)],f=k[n.charCodeAt(s+2)],g=k[n.charCodeAt(s+3)],N[i++]=r<<2|c>>4,N[i++]=(15&c)<<4|f>>2,N[i++]=(3&f)<<6|63&g;return O})(n);return I(e,t)}return{base64:!0,data:n}},I=(n,t)=>"blob"===t&&n instanceof ArrayBuffer?new Blob([n]):n,E=(n,t)=>{if("string"!=typeof n)return{type:"message",data:I(n,t)};const e=n.charAt(0);return"b"===e?{type:"message",data:v(n.substring(1),t)}:P[e]?n.length>1?{type:P[e],data:n.substring(1)}:{type:P[e]}:ct},D=String.fromCharCode(30);function p(n){if(n)return function G(n){for(var t in p.prototype)n[t]=p.prototype[t];return n}(n)}p.prototype.on=p.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this},p.prototype.once=function(n,t){function e(){this.off(n,e),t.apply(this,arguments)}return e.fn=t,this.on(n,e),this},p.prototype.off=p.prototype.removeListener=p.prototype.removeAllListeners=p.prototype.removeEventListener=function(n,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks["$"+n];if(!e)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(var s,i=0;i<e.length;i++)if((s=e[i])===t||s.fn===t){e.splice(i,1);break}return 0===e.length&&delete this._callbacks["$"+n],this},p.prototype.emitReserved=p.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+n],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(e){s=0;for(var i=(e=e.slice(0)).length;s<i;++s)e[s].apply(this,t)}return this},p.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},p.prototype.hasListeners=function(n){return!!this.listeners(n).length};const x=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function mt(n,...t){return t.reduce((e,s)=>(n.hasOwnProperty(s)&&(e[s]=n[s]),e),{})}const $t=setTimeout,Ht=clearTimeout;function X(n,t){t.useNativeTimers?(n.setTimeoutFn=$t.bind(x),n.clearTimeoutFn=Ht.bind(x)):(n.setTimeoutFn=setTimeout.bind(x),n.clearTimeoutFn=clearTimeout.bind(x))}function Yt(n){return"string"==typeof n?function qt(n){let t=0,e=0;for(let s=0,i=n.length;s<i;s++)t=n.charCodeAt(s),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(s++,e+=4);return e}(n):Math.ceil(1.33*(n.byteLength||n.size))}class zt extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class yt extends p{constructor(t){super(),this.writable=!1,X(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new zt(t,e,s)),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=E(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const bt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),vt={};let Ct,wt=0,A=0;function kt(n){let t="";do{t=bt[n%64]+t,n=Math.floor(n/64)}while(n>0);return t}function St(){const n=kt(+new Date);return n!==Ct?(wt=0,Ct=n):n+"."+kt(wt++)}for(;A<64;A++)vt[bt[A]]=A;function Ot(n){let t="";for(let e in n)n.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return t}let Et=!1;try{Et=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Jt=Et;function Tt(n){const t=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||Jt))return new XMLHttpRequest}catch{}if(!t)try{return new(x[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Wt(){}const Gt=null!=new Tt({xdomain:!1}).responseType;let Q=(()=>{class n extends p{constructor(e,s){super(),X(this,s),this.opts=s,this.method=s.method||"GET",this.uri=e,this.async=!1!==s.async,this.data=void 0!==s.data?s.data:null,this.create()}create(){const e=mt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const s=this.xhr=new Tt(e);try{s.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if("POST"===this.method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{4===s.readyState&&(200===s.status||1223===s.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof s.status?s.status:0)},0))},s.send(this.data)}catch(i){return void this.setTimeoutFn(()=>{this.onError(i)},0)}typeof document<"u"&&(this.index=n.requestsCount++,n.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Wt,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return n.requestsCount=0,n.requests={},n})();function xt(){for(let n in Q.requests)Q.requests.hasOwnProperty(n)&&Q.requests[n].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",xt):"function"==typeof addEventListener&&addEventListener("onpagehide"in x?"pagehide":"unload",xt,!1));const jt="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),tt=x.WebSocket||x.MozWebSocket,At=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),ee={websocket:class te extends yt{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=At?{}:mt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=At?new tt(t,e,s):e?new tt(t,e):new tt(t)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=e===t.length-1;J(t[e],this.supportsBinary,r=>{try{this.ws.send(r)}catch{}i&&jt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=St()),this.supportsBinary||(t.b64=1);const i=Ot(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}check(){return!!tt}},polling:class Xt extends yt{constructor(t){if(super(t),this.polling=!1,typeof location<"u"){const s="https:"===location.protocol;let i=location.port;i||(i=s?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==s}this.supportsBinary=Gt&&!(t&&t.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let s=0;this.polling&&(s++,this.once("pollComplete",function(){--s||e()})),this.writable||(s++,this.once("drain",function(){--s||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((n,t)=>{const e=n.split(D),s=[];for(let i=0;i<e.length;i++){const r=E(e[i],t);if(s.push(r),"error"===r.type)break}return s})(t,this.socket.binaryType).forEach(s=>{if("opening"===this.readyState&&"open"===s.type&&this.onOpen(),"close"===s.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((n,t)=>{const e=n.length,s=new Array(e);let i=0;n.forEach((r,c)=>{J(r,!1,f=>{s[c]=f,++i===e&&t(s.join(D))})})})(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=St()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const i=Ot(t);return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Q(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,s)=>{this.onError("xhr poll error",e,s)}),this.pollXhr=t}}},se=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function lt(n){const t=n,e=n.indexOf("["),s=n.indexOf("]");-1!=e&&-1!=s&&(n=n.substring(0,e)+n.substring(e,s).replace(/:/g,";")+n.substring(s,n.length));let i=se.exec(n||""),r={},c=14;for(;c--;)r[ne[c]]=i[c]||"";return-1!=e&&-1!=s&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function ie(n,t){const s=t.replace(/\/{2,9}/g,"/").split("/");return("/"==t.slice(0,1)||0===t.length)&&s.splice(0,1),"/"==t.slice(-1)&&s.splice(s.length-1,1),s}(0,r.path),r.queryKey=function re(n,t){const e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(e[i]=r)}),e}(0,r.query),r}let Rt=(()=>{class n extends p{constructor(e,s={}){super(),e&&"object"==typeof e&&(s=e,e=null),e?(e=lt(e),s.hostname=e.host,s.secure="https"===e.protocol||"wss"===e.protocol,s.port=e.port,e.query&&(s.query=e.query)):s.host&&(s.hostname=lt(s.host).host),X(this,s),this.secure=null!=s.secure?s.secure:typeof location<"u"&&"https:"===location.protocol,s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=s.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},s),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=function Zt(n){let t={},e=n.split("&");for(let s=0,i=e.length;s<i;s++){let r=e[s].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=4,s.transport=e,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts.transportOptions[e],this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new ee[e](i)}open(){let e;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",s=>this.onClose("transport close",s))}probe(e){let s=this.createTransport(e),i=!1;n.priorWebsocketSuccess=!1;const r=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",T=>{if(!i)if("pong"===T.type&&"probe"===T.data){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;n.priorWebsocketSuccess="websocket"===s.name,this.transport.pause(()=>{i||"closed"!==this.readyState&&(it(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const B=new Error("probe error");B.transport=s.name,this.emitReserved("upgradeError",B)}}))};function c(){i||(i=!0,it(),s.close(),s=null)}const f=T=>{const B=new Error("probe error: "+T);B.transport=s.name,c(),this.emitReserved("upgradeError",B)};function g(){f("transport closed")}function O(){f("socket closed")}function N(T){s&&T.name!==s.name&&c()}const it=()=>{s.removeListener("open",r),s.removeListener("error",f),s.removeListener("close",g),this.off("close",O),this.off("upgrading",N)};s.once("open",r),s.once("error",f),s.once("close",g),this.once("close",O),this.once("upgrading",N),s.open()}onOpen(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const s=this.upgrades.length;for(;e<s;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const s=new Error("server error");s.code=e.data,this.onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(s+=Yt(r)),i>0&&s>this.maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}write(e,s,i){return this.sendPacket("message",e,s,i),this}send(e,s,i){return this.sendPacket("message",e,s,i),this}sendPacket(e,s,i,r){if("function"==typeof s&&(r=s,s=void 0),"function"==typeof i&&(r=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const c={type:e,data:s,options:i};this.emitReserved("packetCreate",c),this.writeBuffer.push(c),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}onError(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,s){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const s=[];let i=0;const r=e.length;for(;i<r;i++)~this.transports.indexOf(e[i])&&s.push(e[i]);return s}}return n.protocol=4,n})();const ce="function"==typeof ArrayBuffer,Mt=Object.prototype.toString,he="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Mt.call(Blob),le="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===Mt.call(File);function ut(n){return ce&&(n instanceof ArrayBuffer||(n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer)(n))||he&&n instanceof Blob||le&&n instanceof File}function et(n,t){if(!n||"object"!=typeof n)return!1;if(Array.isArray(n)){for(let e=0,s=n.length;e<s;e++)if(et(n[e]))return!0;return!1}if(ut(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return et(n.toJSON(),!0);for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&et(n[e]))return!0;return!1}function ue(n){const t=[],s=n;return s.data=ft(n.data,t),s.attachments=t.length,{packet:s,buffers:t}}function ft(n,t){if(!n)return n;if(ut(n)){const e={_placeholder:!0,num:t.length};return t.push(n),e}if(Array.isArray(n)){const e=new Array(n.length);for(let s=0;s<n.length;s++)e[s]=ft(n[s],t);return e}if("object"==typeof n&&!(n instanceof Date)){const e={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=ft(n[s],t));return e}return n}function fe(n,t){return n.data=pt(n.data,t),n.attachments=void 0,n}function pt(n,t){if(!n)return n;if(n&&!0===n._placeholder){if("number"==typeof n.num&&n.num>=0&&n.num<t.length)return t[n.num];throw new Error("illegal attachments")}if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=pt(n[e],t);else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=pt(n[e],t));return n}const Nt=5;var l=(()=>{return(n=l||(l={}))[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK",l;var n})();class pe{constructor(t){this.replacer=t}encode(t){return t.type!==l.EVENT&&t.type!==l.ACK||!et(t)?[this.encodeAsString(t)]:(t.type=t.type===l.EVENT?l.BINARY_EVENT:l.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return(t.type===l.BINARY_EVENT||t.type===l.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=ue(t),s=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(s),i}}class dt extends p{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===l.BINARY_EVENT||e.type===l.BINARY_ACK?(this.reconstructor=new de(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!ut(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===l[s.type])throw new Error("unknown packet type "+s.type);if(s.type===l.BINARY_EVENT||s.type===l.BINARY_ACK){const r=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);const c=t.substring(r,e);if(c!=Number(c)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(c)}if("/"===t.charAt(e+1)){const r=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(r,e)}else s.nsp="/";const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const r=e+1;for(;++e;){const c=t.charAt(e);if(null==c||Number(c)!=c){--e;break}if(e===t.length)break}s.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!dt.isPayloadValid(s.type,r))throw new Error("invalid payload");s.data=r}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case l.CONNECT:return"object"==typeof e;case l.DISCONNECT:return void 0===e;case l.CONNECT_ERROR:return"string"==typeof e||"object"==typeof e;case l.EVENT:case l.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case l.ACK:case l.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class de{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=fe(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function S(n,t,e){return n.on(t,e),function(){n.off(t,e)}}const ge=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class gt extends p{constructor(t,e,s){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[S(t,"open",this.onopen.bind(this)),S(t,"packet",this.onpacket.bind(this)),S(t,"error",this.onerror.bind(this)),S(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(ge.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');e.unshift(t);const s={type:l.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const c=this.ids++,f=e.pop();this._registerAckCallback(c,f),s.id=c}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){const s=this.flags.timeout;if(void 0===s)return void(this.acks[t]=e);const i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let r=0;r<this.sendBuffer.length;r++)this.sendBuffer[r].id===t&&this.sendBuffer.splice(r,1);e.call(this,new Error("operation has timed out"))},s);this.acks[t]=(...r)=>{this.io.clearTimeoutFn(i),e.apply(this,[null,...r])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this.packet({type:l.CONNECT,data:t})}):this.packet({type:l.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case l.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case l.EVENT:case l.BINARY_EVENT:this.onevent(t);break;case l.ACK:case l.BINARY_ACK:this.onack(t);break;case l.DISCONNECT:this.ondisconnect();break;case l.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:l.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:l.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function V(n){this.ms=(n=n||{}).min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}V.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*n);n=0==(1&Math.floor(10*t))?n-e:n+e}return 0|Math.min(n,this.max)},V.prototype.reset=function(){this.attempts=0},V.prototype.setMin=function(n){this.ms=n},V.prototype.setMax=function(n){this.max=n},V.prototype.setJitter=function(n){this.jitter=n};class st extends p{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,X(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=e.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new V({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout??2e4),this._readyState="closed",this.uri=t;const i=e.parser||U;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Rt(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=S(e,"open",function(){s.onopen(),t&&t()}),r=S(e,"error",c=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",c),t?t(c):s.maybeReconnectOnOpen()});if(!1!==this._timeout){const c=this._timeout;0===c&&i();const f=this.setTimeoutFn(()=>{i(),e.close(),e.emit("error",new Error("timeout"))},c);this.opts.autoUnref&&f.unref(),this.subs.push(function(){clearTimeout(f)})}return this.subs.push(i),this.subs.push(r),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(S(t,"ping",this.onping.bind(this)),S(t,"data",this.ondata.bind(this)),S(t,"error",this.onerror.bind(this)),S(t,"close",this.onclose.bind(this)),S(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch{this.onclose("parse error")}}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s||(s=new gt(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e)if(this.nsps[s].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},e);this.opts.autoUnref&&s.unref(),this.subs.push(function(){clearTimeout(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const q={};function R(n,t){"object"==typeof n&&(t=n,n=void 0);const e=function oe(n,t="",e){let s=n;e=e||typeof location<"u"&&location,null==n&&(n=e.protocol+"//"+e.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?e.protocol+n:e.host+n),/^(https?|wss?):\/\//.test(n)||(n=typeof e<"u"?e.protocol+"//"+n:"https://"+n),s=lt(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+t,s.href=s.protocol+"://"+r+(e&&e.port===s.port?"":":"+s.port),s}(n,(t=t||{}).path||"/socket.io"),s=e.source,i=e.id;let g;return t.forceNew||t["force new connection"]||!1===t.multiplex||q[i]&&e.path in q[i].nsps?g=new st(s,t):(q[i]||(q[i]=new st(s,t)),g=q[i]),e.query&&!t.query&&(t.query=e.queryKey),g.socket(e.path,t)}Object.assign(R,{Manager:st,Socket:gt,io:R,connect:R});class Bt{constructor(t){this.config=t,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===t&&(t=this.emptyConfig),this.ioSocket=(R||y)(t.url,t.options)}of(t){this.ioSocket.of(t)}on(t,e){this.ioSocket.on(t,e)}once(t,e){this.ioSocket.once(t,e)}connect(){return this.ioSocket.connect()}disconnect(t){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(t,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(t,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(t){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(t){return this.subscribersCounter[t]||(this.subscribersCounter[t]=0),this.subscribersCounter[t]++,this.eventObservables$[t]||(this.eventObservables$[t]=new $.y(e=>{const s=i=>{e.next(i)};return this.ioSocket.on(t,s),()=>{this.subscribersCounter[t]--,0===this.subscribersCounter[t]&&(this.ioSocket.removeListener(t,s),delete this.eventObservables$[t])}}).pipe((0,ot.B)())),this.eventObservables$[t]}fromOneTimeEvent(t){return new Promise(e=>this.once(t,e))}}new o.OlP("__SOCKET_IO_CONFIG__");var me=a(2340);class ye{constructor(t){this.socket=t,this.socketStatus=!0,this.checkStatus()}checkStatus(){this.socket.on("connect",()=>{!this.socketStatus&&this._roomId&&this.setRoom(this._roomId),this.socketStatus=!0}),this.socket.on("disconnect",()=>{this.socketStatus=!1})}setRoom(t){this._roomId=t,this.socket.emit("setRoom",{roomId:t})}sendMessage(t){this.socket.emit("sendMessage",t)}getMessages(){return this.socket.fromEvent("receiveMessage")}close(){this.socket.disconnect()}}var M=a(6895),Lt=a(4285);const be=function(n){return{"chat-bubble":!0,darkMode:n}};let ve=(()=>{class n{constructor(e){this.appState=e,this.owner=!1,this.lastComponentViewRender=new o.vpe}ngAfterViewInit(){this.isLast&&this.lastComponentViewRender.emit(this.isLast)}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(Lt.Z))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-chat-bubble"]],inputs:{owner:"owner",textMessage:"textMessage",timeStamp:"timeStamp",isLast:"isLast"},outputs:{lastComponentViewRender:"lastComponentViewRender"},standalone:!0,features:[o.jDz],decls:4,vars:7,consts:[[3,"ngClass"]],template:function(e,s){1&e&&(o.TgZ(0,"div",0),o.ALo(1,"async"),o.TgZ(2,"p"),o._uU(3),o.qZA()()),2&e&&(o.Q6J("ngClass",o.VKq(5,be,o.lcZ(1,3,s.appState.darkMode$))),o.uIk("data-owner",s.owner),o.xp6(3),o.hij(" ",s.textMessage," "))},dependencies:[M.ez,M.mk,M.Ov],styles:[".chat-bubble[_ngcontent-%COMP%]{padding:.8em 1em;margin:5px 0 0;border-top-right-radius:20px;border-top-left-radius:20px;max-width:60%}.chat-bubble[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-family:sans-serif;font-size:1em;font-weight:600;word-break:break-all}.chat-bubble[data-owner=true][_ngcontent-%COMP%]{background-color:#b5b5d3;border-bottom-left-radius:20px;float:right;margin-right:5px}.chat-bubble[data-owner=true].darkMode[_ngcontent-%COMP%]{background-color:#542ba1}.chat-bubble[data-owner=false][_ngcontent-%COMP%]{background-color:#d3b9c2;border-bottom-right-radius:20px;float:left}.chat-bubble[data-owner=false].darkMode[_ngcontent-%COMP%]{background-color:#a12b2b}"],changeDetection:0}),n})(),we=(()=>{class n{constructor(e){this.viewContainerRef=e}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.s_b))},n.\u0275dir=o.lG2({type:n,selectors:[["","appContentRef",""]]}),n})();var Pt=a(4859),It=a(7392),nt=a(4006),Ce=a(4968),ke=a(4986),Se=a(4482),Dt=a(5403),Oe=a(8421);const Ft={leading:!0,trailing:!1};var Te=a(5963);let Ae=(()=>{class n{constructor(e){this.el=e,this.infiniteScrollDistance=10,this._throttleTime=700,this.throttleDistance=300,this.scrollingUp=new o.vpe,this.eventSubscription=[],this.diffPointer=0,this.eventSubscription.push((0,Ce.R)(this.el.nativeElement,"scroll").pipe(function xe(n,t=ke.z,e=Ft){const s=(0,Te.H)(n,t);return function Ee(n,t=Ft){return(0,Se.e)((e,s)=>{const{leading:i,trailing:r}=t;let c=!1,f=null,g=null,O=!1;const N=()=>{g?.unsubscribe(),g=null,r&&(B(),O&&s.complete())},it=()=>{g=null,O&&s.complete()},T=_=>g=(0,Oe.Xf)(n(_)).subscribe((0,Dt.x)(s,N,it)),B=()=>{if(c){c=!1;const _=f;f=null,s.next(_),!O&&T(_)}};e.subscribe((0,Dt.x)(s,_=>{c=!0,f=_,(!g||g.closed)&&(i?B():T(_))},()=>{O=!0,(!(r&&c&&g)||g.closed)&&s.complete()}))})}(()=>s,e)}(this._throttleTime)).subscribe(s=>{const i=this.el.nativeElement,r=Math.round(i.scrollHeight-i.scrollTop),c=i.scrollHeight-i.scrollHeight*(this.infiniteScrollDistance/100);r>i.clientHeight&&r>c&&r>this.diffPointer&&(console.log(r,i.clientHeight,c),this.diffPointer=r+this.throttleDistance,this.scrollingUp.emit("scrolling up"))}))}ngOnChanges(e){this.diffPointer=0}ngOnDestroy(){this.eventSubscription.forEach(e=>{e?.unsubscribe()})}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(o.SBq))},n.\u0275dir=o.lG2({type:n,selectors:[["","appInfiniteScroll",""]],inputs:{infiniteScrollDistance:"infiniteScrollDistance",_throttleTime:["throttleTime","_throttleTime"],throttleDistance:"throttleDistance",restDistancePointer:["restThrottleDistancePointObservable","restDistancePointer"]},outputs:{scrollingUp:"scrollingUp"},standalone:!0,features:[o.TTD]}),n})();var Vt=a(8350);let Re=(()=>{class n{constructor(){this.allMessage=[]}getMessage(e,s){return this.allMessage.filter(i=>i.to==s).map(i=>({username:i.from,textMessage:i.textMessage,timeStamp:i.time}))}pushMessage(e,s,i){this.allMessage.push({to:s,from:e,textMessage:i,time:Date.now()})}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=o.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Me=a(5526);const Ne=["scroll"];function Be(n,t){1&n&&(o.TgZ(0,"div",13),o._uU(1," Can not connect to server "),o.qZA())}function _e(n,t){if(1&n){const e=o.EpF();o.TgZ(0,"app-chat-bubble",14,15),o.NdJ("lastComponentViewRender",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.lastComponentViewRender())}),o.qZA()}if(2&n){const e=t.$implicit,s=t.last,i=o.oxw();o.Q6J("owner",e.from_uid==(null==i.appState.user?null:i.appState.user.uid))("timeStamp",1221)("textMessage",e.content)("isLast",s)}}const Le=function(n){return{"chat-view-section":!0,darkMode:n}};let Pe=(()=>{class n{constructor(e,s,i,r,c){this._Activatedroute=e,this._router=s,this.chatService=i,this.appState=r,this.db=c,this.docId=null,this.roomId=null,this.textMessage=null,this.messageListSubject=new L.X([]),this.messageList$=this.messageListSubject.asObservable(),this.otherPerson=null,this.apiLimit=50,this.apiOffset=0,this.isNextPageAvailable=!0,this._Activatedroute.paramMap.subscribe(f=>{this.onRouteChange(f,c)})}ngOnInit(){this.scrollToBottom()}onRouteChange(e,s){if(this.chatSocket=this.constructSocket(),this.docId=e.get("docId"),this.roomId=e.get("roomId"),this.docId&&this.roomId){this.restDistancePointer=!this.restDistancePointer,this.messageListSubject.next([]),this.isNextPageAvailable=!0,this.apiLimit=50,this.apiOffset=0,this.messageListViewChildRef?.viewContainerRef.clear(),this.chatSocket?.setRoom(this.roomId);const i=this.chatSocket?.getMessages();i&&this.loadMessageFromObservable(i),s.getUserWithDocId(this.docId).subscribe({next:r=>{this.otherPerson=r,this.loadMessage()},error:r=>this.appState.showError("Error! Invalid Id")})}}constructSocket(){return this.chatSocket&&this.chatSocket.close(),new ye(new Bt({url:me.N.chatSocketUrl,options:{}}))}lastComponentViewRender(){this.scrollToBottom()}scrollToBottom(){try{this.scroll.nativeElement.scrollTop=this.scroll?.nativeElement.scrollHeight}catch{}}sendMessage(e){const{code:s,type:r}=e;!this.roomId||("Enter"==s||"click"==r)&&this.textMessage&&(this.chatSocket?.sendMessage({from_uid:this.appState.user?.uid,content:this.textMessage,roomId:this.roomId,createdAt:Date.now()}),this.textMessage="")}loadMessage(){!this.roomId||!this.isNextPageAvailable||this.db.getMessages(this.roomId,this.apiLimit,this.apiOffset).pipe((0,rt.b)(e=>{console.log(e),this.isNextPageAvailable=!!e.next,this.apiOffset+=this.apiLimit,this.messageListSubject.next([...e.results.reverse(),...this.messageListSubject.getValue()])})).subscribe()}loadMessageFromObservable(e){e.subscribe(s=>{const i=this.messageListSubject.getValue();this.messageListSubject.next([...i,s]),this.scrollToBottom()})}goBack(){this._router.navigate(["home"])}onScrollUp(){this.loadMessage()}ngOnDestroy(){this.chatSocket?.close()}}return n.\u0275fac=function(e){return new(e||n)(o.Y36(Vt.gz),o.Y36(Vt.F0),o.Y36(Re),o.Y36(Lt.Z),o.Y36(Me.d))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-chat-view"]],viewQuery:function(e,s){if(1&e&&(o.Gf(Ne,7),o.Gf(we,7)),2&e){let i;o.iGM(i=o.CRH())&&(s.scroll=i.first),o.iGM(i=o.CRH())&&(s.messageListViewChildRef=i.first)}},standalone:!0,features:[o.jDz],decls:23,vars:13,consts:[[3,"ngClass"],["class","connectionStatus",4,"ngIf"],[1,"nav"],["mat-icon-button","","aria-label","go back button",3,"click"],["data-active","true",1,"username-placeholder"],["mat-icon-button",""],[1,"chat-view-body"],["appInfiniteScroll","",1,"message-list",3,"restThrottleDistancePointObservable","throttleDistance","scrollingUp"],["scroll",""],[3,"owner","timeStamp","textMessage","isLast","lastComponentViewRender",4,"ngFor","ngForOf"],[1,"input-section"],["type","text",1,"input-field",3,"ngModel","ngModelChange","keydown"],["mat-raised-button","","color","primary",1,"send-button",3,"click"],[1,"connectionStatus"],[3,"owner","timeStamp","textMessage","isLast","lastComponentViewRender"],["messages",""]],template:function(e,s){1&e&&(o.TgZ(0,"section",0),o.ALo(1,"async"),o.YNc(2,Be,2,0,"div",1),o.TgZ(3,"nav",2)(4,"button",3),o.NdJ("click",function(){return s.goBack()}),o.TgZ(5,"mat-icon"),o._uU(6,"arrow_back"),o.qZA()(),o.TgZ(7,"div",4)(8,"span"),o._uU(9),o.qZA()(),o.TgZ(10,"button",5)(11,"mat-icon"),o._uU(12,"info"),o.qZA()()(),o.TgZ(13,"main",6)(14,"div",7,8),o.NdJ("scrollingUp",function(){return s.onScrollUp()}),o.YNc(16,_e,2,4,"app-chat-bubble",9),o.ALo(17,"async"),o.qZA(),o.TgZ(18,"div",10)(19,"input",11),o.NdJ("ngModelChange",function(r){return s.textMessage=r})("keydown",function(r){return s.sendMessage(r)}),o.qZA(),o.TgZ(20,"button",12),o.NdJ("click",function(r){return s.sendMessage(r)}),o.TgZ(21,"mat-icon"),o._uU(22,"send"),o.qZA()()()()()),2&e&&(o.Q6J("ngClass",o.VKq(11,Le,o.lcZ(1,7,s.appState.darkMode$))),o.xp6(2),o.Q6J("ngIf",!(null!=s.chatSocket&&s.chatSocket.socketStatus)),o.xp6(7),o.Oqu(null==s.otherPerson?null:s.otherPerson.displayName),o.xp6(5),o.Q6J("restThrottleDistancePointObservable",s.restDistancePointer)("throttleDistance",200),o.xp6(2),o.Q6J("ngForOf",o.lcZ(17,9,s.messageList$)),o.xp6(3),o.Q6J("ngModel",s.textMessage))},dependencies:[M.ez,M.mk,M.sg,M.O5,M.Ov,ve,It.Ps,It.Hw,Pt.ot,Pt.lW,nt.u5,nt.Fj,nt.JJ,nt.On,Ae],styles:['.chat-view-section[_ngcontent-%COMP%]{position:relative}.nav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;box-shadow:-2px 3px 4px 1px #dce4dc;border-radius:19px}.darkMode[_ngcontent-%COMP%]   .nav[_ngcontent-%COMP%]{box-shadow:-2px 3px 4px 1px #0009}.username-placeholder[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.username-placeholder[_ngcontent-%COMP%]:after{content:"";width:10px;height:10px;border-radius:50%;position:absolute}.username-placeholder[data-active=true][_ngcontent-%COMP%]:after{background-color:#21d900}.username-placeholder[data-active=false][_ngcontent-%COMP%]:after{background-color:#3b3a3a}.chat-view-body[_ngcontent-%COMP%]{display:flex;flex-direction:column}.message-list[_ngcontent-%COMP%]{height:calc(100vh - 176px);overflow:hidden;overflow-y:scroll}.input-section[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:5px}.input-section[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{width:100%;background-color:inherit;color:inherit;border:2px solid rgb(62,61,61)}.darkMode[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]{border:1px solid white}.darkMode[_ngcontent-%COMP%]   .input-field[_ngcontent-%COMP%]:focus-visible{background-color:inherit;color:inherit;outline:3px auto white}.message-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}.connectionStatus[_ngcontent-%COMP%]{text-align:center;background:#b30b0b;color:#fff;border-radius:4px}']}),n})()},5526:(Ut,z,a)=>{a.d(z,{d:()=>J});var U=a(5861),y=a(9226),L=a(8505),rt=a(3099),o=a(9646),$=a(4004),ot=a(4482),w=a(5403),P=a(4671),ct=a(5963),at=a(8421);function H(m=1/0){let k;k=m&&"object"==typeof m?m:{count:m};const{count:h=1/0,delay:u,resetOnSuccess:d=!1}=k;return h<=0?P.y:(0,ot.e)((b,v)=>{let E,I=0;const D=()=>{let W=!1;E=b.subscribe((0,w.x)(v,F=>{d&&(I=0),v.next(F)},void 0,F=>{if(I++<h){const Y=()=>{E?(E.unsubscribe(),E=null,D()):W=!0};if(null!=u){const p="number"==typeof u?(0,ct.H)(u):(0,at.Xf)(u(F,I)),G=(0,w.x)(v,()=>{G.unsubscribe(),Y()},()=>{v.complete()});p.subscribe(G)}else Y()}else v.error(F)})),W&&(E.unsubscribe(),E=null,D())};D()})}var C=a(2340),K=a(4650),Z=a(529);let J=(()=>{class m{constructor(h,u){this.fireStore=h,this.http=u,this.userCollection=null,this.userCollection=(0,y.hJ)(this.fireStore,"user")}userExits(h){var u=this;return(0,U.Z)(function*(){const d=(0,y.IO)(u.userCollection,(0,y.ar)("uid","==",h.uid)),b=yield(0,y.PL)(d);return 1==b.size?b.docs[0].id:null})()}getUserWithDocId(h){return this.http.get(`${C.N.api}/get-user/${h}`).pipe((0,L.b)(u=>{console.log(u)}))}getMessages(h,u=10,d=0){return this.http.get(`${C.N.api}/get-messages/${h}?limit=${u}&offset=${d}`)}getMessageSnapShort(h,u){const d=(0,y.IO)((0,y.hJ)(this.fireStore,"/message_room/rooms/"+h),(0,y.Xo)("createdAt","desc"));return(0,y.cf)(d,{next:b=>{console.log(b),u(b.docs.map(v=>v.data()))}})}sendMessage(h,u){return(0,y.ET)((0,y.hJ)(this.fireStore,"/message_room/rooms/"+u),{...h,createdAt:(0,y.Bt)()})}addUser(h){return this.http.post(`${C.N.api}/save-or-crate-user`,h)}getFriendsList(h){return this.http.get(`${C.N.api}/get-add-friends/${h}`).pipe((0,rt.B)())}getUserList(h,u,d=100,b=0){return h?this.http.get(`${C.N.api}/get-users/${h}?q=${u}&limit=${d}&offset=${b}`).pipe((0,$.U)(v=>v.results)):(0,o.of)([])}getAllFriends(h,u,d=100,b=0){return h?this.http.get(`${C.N.api}/get-all-friends/${h}?q=${u}&limit=${d}&offset=${b}`).pipe((0,$.U)(v=>v.results)):(0,o.of)([])}getAllFriendRequest(h,u,d=100,b=0){return h?this.http.get(`${C.N.api}/get-all-friend-request/${h}?q=${u}&limit=${d}&offset=${b}`).pipe((0,$.U)(v=>v.results)):(0,o.of)([])}addFriends(h,u){return this.http.post(`${C.N.api}/add-friends`,{uid_first:h,uid_second:u}).pipe(H(2),(0,L.b)(d=>{console.log(d)}))}removeFriends(h,u){return this.http.post(`${C.N.api}/remove-friends`,{uid_first:h,uid_second:u}).pipe(H(2),(0,L.b)(d=>{console.log(d)}))}acceptFriends(h,u){return this.http.post(`${C.N.api}/accept-friends`,{uid_first:h,uid_second:u}).pipe(H(2),(0,L.b)(d=>{console.log(d)}))}}return m.\u0275fac=function(h){return new(h||m)(K.LFG(y.gg),K.LFG(Z.eN))},m.\u0275prov=K.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);